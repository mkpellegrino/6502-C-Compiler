needs( "mul16" );

void main()
{
  saveregs();

  data characterset =
    {
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // space
      0x00, 0x30, 0x30, 0x30, 0x30, 0x00, 0x30, 0x30, // !
      0x00, 0xCC, 0xCC, 0x00, 0x00, 0x00, 0x00, 0x00, // "
      0x00, 0x3C, 0x30, 0x30, 0xFC, 0x30, 0x33, 0xFF, // Lb
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // $
      0x00, 0x30, 0xF0, 0xF0, 0x30, 0x3C, 0x3C, 0x30, // %
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // &
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // '
      0x0C, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x0C, // (
      0xC0, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0xC0, // )

      0xFF, 0xFF, 0xC0, 0xC0, 0xD5, 0xD5, 0xEA, 0xEA, // *
      0xFF, 0xFF, 0x00, 0x00, 0x55, 0x55, 0xAA, 0xAA, // +
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xC0, // ,
      0x00, 0x00, 0x00, 0x3C, 0x3C, 0x00, 0x00, 0x00, // -
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, // .
      0x03, 0x03, 0x0C, 0x0C, 0x30, 0x30, 0xC0, 0xC0, // /
      0x00, 0x30, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0x30, // 0
      0x00, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, // 1
      0x00, 0x30, 0xCC, 0x0C, 0x30, 0xC0, 0xC0, 0xFC, // 2
      0x00, 0x30, 0xCC, 0x0C, 0x30, 0x0C, 0xCC, 0x30, // 3

      0x00, 0x0C, 0xCC, 0xCC, 0xFC, 0x0C, 0x0C, 0x0C, // 4
      0x00, 0xFC, 0xC0, 0xF0, 0x0C, 0x0C, 0xCC, 0x30, // 5
      0x00, 0x30, 0xCC, 0xC0, 0xF0, 0xCC, 0xCC, 0x30, // 6
      0x00, 0xFC, 0x0C, 0x0C, 0x30, 0x30, 0x30, 0x30, // 7
      0x00, 0x30, 0xCC, 0xCC, 0x30, 0xCC, 0xCC, 0x30, // 8
      0x00, 0xFC, 0xCC, 0xCC, 0xFC, 0x0C, 0x0C, 0x0C, // 9
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // :
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // ;
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // <
      0x00, 0x00, 0x3C, 0x00, 0x3C, 0x00, 0x00, 0x00, // =

      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // >
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // ?
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // @
      0x00, 0x30, 0xFC, 0xCC, 0xFC, 0xCC, 0xCC, 0xCC,  //  A
      0x00, 0xF0, 0xCC, 0xCC, 0xF0, 0xCC, 0xCC, 0xF0, // B
      0x00, 0x30, 0xCC, 0xC0, 0xC0, 0xC0, 0xCC, 0x30, // C
      0x00, 0xF0, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xF0, // D
      0x00, 0xFC, 0xC0, 0xC0, 0xF0, 0xC0, 0xC0, 0xFC, // E
      0x00, 0xFC, 0xC0, 0xC0, 0xF0, 0xC0, 0xC0, 0xC0, // F
      0x00, 0x30, 0xCC, 0xC0, 0xFC, 0xCC, 0xCC, 0x30, // G

      0x00, 0xCC, 0xCC, 0xCC, 0xFC, 0xCC, 0xCC, 0xCC, // H
      0x00, 0xFC, 0x30, 0x30, 0x30, 0x30, 0x30, 0xFC, // I
      0x00, 0xFC, 0x0C, 0x0C, 0x0C, 0xCC, 0xCC, 0x30,  // J
      0x00, 0xCC, 0xCC, 0xCC, 0xF0, 0xCC, 0xCC, 0xCC, // K
      0x00, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xFC,  // L
      0x00, 0xCC, 0xFC, 0xFC, 0xCC, 0xCC, 0xCC, 0xCC,  // M
      0x00, 0x00, 0x00, 0xC0, 0xFC, 0xCC, 0xCC, 0xCC, // N
      0x00, 0xFC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xFC,  // O
      0x00, 0xF0, 0xCC, 0xCC, 0xF0, 0xC0, 0xC0, 0xC0, // P
      0x00, 0x30, 0xCC, 0xCC, 0xCC, 0xCC, 0xF0, 0x3C, // Q

      0x00, 0xF0, 0xCC, 0xCC, 0xF0, 0xCC, 0xCC, 0xCC, // R
      0x00, 0x30, 0xCC, 0xC0, 0x30, 0x0C, 0xCC, 0x30, // S
      0x00, 0xFC, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, // T
      0x00, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xFC, // U
      0x00, 0xCC, 0xCC, 0xCC, 0xCC, 0x30, 0x30, 0x30, // V
      0x00, 0xCC, 0xCC, 0xCC, 0xFC, 0xFC, 0xFC, 0xCC, // W
      0x00, 0xCC, 0xCC, 0xCC, 0x30, 0xCC, 0xCC, 0xCC, // X
      0x00, 0xCC, 0xCC, 0xCC, 0x3C, 0x0C, 0xCC, 0x30, // Y
      0x00, 0xFC, 0x0C, 0x0C, 0x30, 0xC0, 0xC0, 0xFC, // Z
      0x0F, 0x35, 0xD5, 0xD5, 0xEA, 0xEA, 0x3A, 0x0F, // [

      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // Lb
      0xF0, 0x5C, 0x57, 0x57, 0xAB, 0xAB, 0xAC, 0xF0, // ]
      0x00, 0x3C, 0xC3, 0x00, 0x00, 0x00, 0x00, 0x00, // ^
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // <--
      0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00 // -
    };

  data HWtext =  { "HELLO WORLD!  HELLO WORLD!  HELLO WORLD!" };
  data HWtext2 = { "01234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ/^%" };
  data Text3 = { "[" };
  data Text4 = { "]" };
  bank(2);

  setScreenMode( 0x03 );
  poke( 0xD018, 0x18 );
    
  romout(6);

  word bmpaddr = getbmp_addr();
  word bmpaddrX = bmpaddr + 0x1FF8;
  word scraddr = getscr_addr();
  word scraddrX = scraddr + 0x03EF;

  fillmem( 0xD8, 0x06, 0x04 );
  fillmem( 0x84, 0x7D, 0x04 );
  clearmem( 0xA0, 0x20 );
  
  bmPrintInit( 0xA0, 0x84, characterset );

  for( uint j = 0x00; j < 0x19; inc( j ) )
    {
      for( uint i = 0x00; i < 0x28; i = i + 0x02 )
	{ 
	  bmPrint( i, j, Text3, 0x00, rnd());
	  bmPrint( i + 0x01, j, Text4, 0x00, rnd() );
	}
    }
  pause();

  clearmem( 0xA0, 0x20 );
  bmPrint( 0, 0, HWtext, 0x00, 0x12);
  bmPrint( 0, 1, HWtext2, 0x01, 0x02);

  pause();
  
  romin();
  bank(0);

  restoreregs();
  
  return;

}
